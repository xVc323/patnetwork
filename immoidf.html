<!DOCTYPE html>
<html lang="fr" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Immo Paris</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'system-ui', '-apple-system', 'sans-serif'],
          }
        }
      }
    }
  </script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
    .dark ::-webkit-scrollbar-thumb { background: #475569; }
    .score-badge {
      min-width: 2.5rem; height: 2.5rem;
      display: inline-flex; align-items: center; justify-content: center;
      border-radius: 0.5rem; font-weight: 700; font-size: 0.875rem;
    }
    .custom-cluster {
      background: transparent !important;
    }
    .custom-cluster > div {
      width: 40px; height: 40px;
    }
    .card-img { aspect-ratio: 4/3; object-fit: cover; }
    .carousel { aspect-ratio: 4/3; }
    .carousel-img { transition: opacity 0.2s; }
    @media (max-width: 640px) {
      .card-img, .carousel { aspect-ratio: 16/9; }
    }
    /* Leaflet popup image */
    .leaflet-popup-content img { margin: 0 !important; }
  </style>
</head>
<body class="h-full bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100 font-sans">

  <!-- Header -->
  <header class="sticky top-0 z-50 bg-white/95 dark:bg-slate-800/95 backdrop-blur border-b border-slate-200 dark:border-slate-700">
    <div class="max-w-7xl mx-auto px-4 py-3">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <h1 class="text-lg font-bold tracking-tight">üè† Immo Paris</h1>
          <span id="countBadge" class="hidden sm:inline bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 px-2.5 py-0.5 rounded-full text-xs font-semibold"></span>
        </div>
        
        <div class="flex items-center gap-2">
          <!-- Mobile: Toggle Map/List -->
          <button id="toggleView" class="lg:hidden p-2 rounded-lg bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 transition">
            <svg id="iconMap" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"/>
            </svg>
            <svg id="iconList" class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"/>
            </svg>
          </button>
          
          <!-- Filters Toggle -->
          <button id="toggleFilters" class="p-2 rounded-lg bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 transition">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/>
            </svg>
          </button>
          
          <!-- Dark Mode -->
          <button id="toggleDark" class="p-2 rounded-lg bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 transition">
            <svg id="iconSun" class="w-5 h-5 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
            </svg>
            <svg id="iconMoon" class="w-5 h-5 dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
            </svg>
          </button>
        </div>
      </div>
      
      <!-- Collapsible Filters -->
      <div id="filtersPanel" class="hidden mt-3 pt-3 border-t border-slate-200 dark:border-slate-700">
        <div class="flex flex-wrap gap-3 items-end">
          <div class="flex flex-col gap-1">
            <label class="text-xs text-slate-500 dark:text-slate-400">Trier par</label>
            <select id="sortSelect" class="text-sm px-3 py-1.5 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
              <option value="score">Score ‚Üì</option>
              <option value="price_asc">Prix ‚Üë</option>
              <option value="price_desc">Prix ‚Üì</option>
              <option value="surface_desc">Surface ‚Üì</option>
              <option value="commute_asc">Trajet ‚Üë</option>
              <option value="delta_asc">Œî% ‚Üë (bonnes affaires)</option>
            </select>
          </div>
          
          <div class="flex flex-col gap-1">
            <label class="text-xs text-slate-500 dark:text-slate-400">Affichage Œî</label>
            <div class="flex rounded-lg border border-slate-300 dark:border-slate-600 overflow-hidden">
              <button id="btnModePrice" class="px-3 py-1.5 text-sm bg-slate-800 text-white dark:bg-slate-200 dark:text-slate-900">‚Ç¨/m¬≤</button>
              <button id="btnModeDelta" class="px-3 py-1.5 text-sm bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700">%</button>
            </div>
          </div>
          
          <div class="flex flex-col gap-1">
            <label class="text-xs text-slate-500 dark:text-slate-400">Surface min</label>
            <input type="number" id="filterSurface" value="30" class="w-20 text-sm px-3 py-1.5 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800">
          </div>
          
          <div class="flex flex-col gap-1">
            <label class="text-xs text-slate-500 dark:text-slate-400">Arrondissement</label>
            <select id="filterArr" class="text-sm px-3 py-1.5 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800">
              <option value="">Tous</option>
            </select>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="flex-1 flex flex-col lg:flex-row" style="height: calc(100vh - 60px); min-height: 400px;">
    
    <!-- Cards List -->
    <div id="listPanel" class="flex-1 overflow-y-auto p-4 lg:w-1/2 xl:w-5/12 h-full">
      <div id="cardsGrid" class="grid gap-3 sm:gap-4"></div>
      <div id="emptyState" class="hidden text-center py-12 text-slate-500">
        Aucun bien ne correspond aux filtres.
      </div>
    </div>

    <!-- Map -->
    <div id="mapPanel" class="hidden lg:flex lg:flex-1 h-full">
      <div id="map" class="w-full h-full"></div>
    </div>
  </main>

  <script>
    // Data
    const items = [{"building": {"floor": null, "is_ground_floor": null}, "commute": {"computed_from": "address", "minutes_total": 51, "minutes_transit_only": 51, "mode": "transit", "notes": null}, "derived": {"arrondissement": "75017", "price_per_m2": 12647.06, "quartier": "Ternes"}, "description": null, "dvf_bonus": {"delta_vs_ref_pct": 26.47, "price_m2_ref": 10000.0, "ref_level": "arrondissement"}, "energy": {"dpe_letter": null}, "geo": {"confidence": 0.0, "lat": 48.8850543, "lon": 2.2978528, "precision": "address"}, "images": [], "listing_url": "https://www.seloger.com/annonces/achat/appartement/paris-17eme-75/pereire-malesherbes/255156133.htm", "location_hint": {"address_text": "Pereire-Malesherbes, Paris 17\u00e8me, 75017", "arrondissement_text": "Pereire-Malesherbes", "confidence": 0.0, "poi_or_station": null, "quartier_text": null, "walk_minutes_to_poi": null}, "photos": ["https://mms.seloger.com/b/d/7/4/bd74e2b1-d0ab-410a-b570-8498e15b9541.jpg?ci_seal=7e6e598608383d60d23b2abb89be25db5d5a804e\u0026w=1024\u0026h=576", "https://mms.seloger.com/d/2/2/d/d22d502f-0b94-4861-a18f-8b26fae5fbeb.jpg?ci_seal=7311a0fab94ed93556ffe2952f838befb434fc14\u0026w=1024\u0026h=576", "https://mms.seloger.com/a/2/7/f/a27f1931-fae8-4865-b2a7-a561d1cb6745.jpg?ci_seal=1ffdcdfe29839a35fa62f63604fd92c38f0e41c3\u0026w=1024\u0026h=576"], "price_eur": 430000, "property_condition": {"is_new": null, "is_old": null, "year_built": null}, "raw_text": null, "rooms": 2.0, "source": "seloger", "surface_m2": 34.0, "title": "Paris XVII/ Wagram-Pereire - 2 pi\u00e8ces Enti\u00e8rement r\u00e9nov\u00e9 et m"}, {"building": {"floor": null, "is_ground_floor": null}, "commute": {"computed_from": "address", "minutes_total": 48, "minutes_transit_only": 48, "mode": "transit", "notes": null}, "derived": {"arrondissement": "75011", "price_per_m2": 9603.34, "quartier": "Folie-Mericourt"}, "description": null, "dvf_bonus": {"delta_vs_ref_pct": -2.41, "price_m2_ref": 9840.0, "ref_level": "arrondissement"}, "energy": {"dpe_letter": null}, "geo": {"confidence": 0.0, "lat": 48.8728179, "lon": 2.389461, "precision": "address"}, "images": [], "listing_url": "https://www.seloger.com/annonces/achat/appartement/paris-11eme-75/belleville-saint-maur/254618631.htm", "location_hint": {"address_text": "Belleville-Saint Maur, Paris 11\u00e8me, 75011", "arrondissement_text": "Belleville-Saint Maur", "confidence": 0.0, "poi_or_station": null, "quartier_text": null, "walk_minutes_to_poi": null}, "photos": ["https://mms.seloger.com/e/8/8/e/e88eb025-9993-4d0d-979b-b58396ff3cb2.jpg?ci_seal=ec4a6e134d8188a4624ff43e88e040a0682ee4a8\u0026w=1024\u0026h=576", "https://mms.seloger.com/f/9/3/f/f93fb8d3-dd98-40ee-abe6-7758a1d68522.jpg?ci_seal=0e61010ca8261a5a0405a6c1706b7255c02fe625\u0026w=1024\u0026h=576", "https://mms.seloger.com/7/e/b/7/7eb7fb66-dc39-4593-8129-3facf84b3e31.jpg?ci_seal=304be522eabca5bd1000a90ecd011c7fc45beda3\u0026w=1024\u0026h=576"], "price_eur": 460000, "property_condition": {"is_new": null, "is_old": null, "year_built": null}, "raw_text": null, "rooms": 2.0, "source": "seloger", "surface_m2": 47.9, "title": "Paris 11e - BELLEVILLE / OBERKAMPF - Loft \u00e0 vendre - 2 pi\u00e8ces -"}, {"building": {"floor": null, "is_ground_floor": null}, "commute": {"computed_from": "address", "minutes_total": 33, "minutes_transit_only": 33, "mode": "transit", "notes": null}, "derived": {"arrondissement": "75010", "price_per_m2": 10483.87, "quartier": "Saint-Vincent-de-Paul"}, "description": null, "dvf_bonus": {"delta_vs_ref_pct": 14.82, "price_m2_ref": 9131.0, "ref_level": "arrondissement"}, "energy": {"dpe_letter": null}, "geo": {"confidence": 0.0, "lat": 48.8698004, "lon": 2.352704, "precision": "address"}, "images": [], "listing_url": "https://www.seloger.com/annonces/achat/appartement/paris-10eme-75/porte-saint-denis-paradis/254074285.htm", "location_hint": {"address_text": "Porte Saint Denis-Paradis, Paris 10\u00e8me, 75010", "arrondissement_text": "Porte Saint Denis-Paradis", "confidence": 0.0, "poi_or_station": null, "quartier_text": null, "walk_minutes_to_poi": null}, "photos": ["https://mms.seloger.com/6/d/6/5/6d65220d-d3e0-494d-89df-38e4fcf4fcec.jpg?ci_seal=2715774261adc33b8ad4f22b5101c67906d05400\u0026w=1024\u0026h=576", "https://mms.seloger.com/c/6/0/3/c603016a-e5f2-46e2-bfd9-85539e42c7e3.jpg?ci_seal=7de14db95680c73cbdfcc65982bb664ee0cd7863\u0026w=1024\u0026h=576", "https://mms.seloger.com/6/3/e/7/63e78fab-2cae-4f0a-a3a8-38b4d6781779.jpg?ci_seal=c072845602a0beb433582e4f9dad5e74e10a45ce\u0026w=1024\u0026h=576", "https://mms.seloger.com/d/a/6/8/da68ccde-77b9-499d-87ca-0649d77a423e.jpg?ci_seal=971607f54621bb29b62f06eae59e2194167f4b01\u0026w=768\u0026h=560"], "price_eur": 390000, "property_condition": {"is_new": null, "is_old": null, "year_built": null}, "raw_text": null, "rooms": 2.0, "source": "seloger", "surface_m2": 37.2, "title": "Paris 10e - RUE DE PARADIS  - Appartement \u00e0 vendre - 1 pi\u00e8ce - 3"}, {"building": {"floor": null, "is_ground_floor": null}, "commute": {"computed_from": "address", "minutes_total": 51, "minutes_transit_only": 51, "mode": "transit", "notes": null}, "derived": {"arrondissement": "75011", "price_per_m2": 9952.61, "quartier": "Folie-Mericourt"}, "description": null, "dvf_bonus": {"delta_vs_ref_pct": 1.14, "price_m2_ref": 9840.0, "ref_level": "arrondissement"}, "energy": {"dpe_letter": null}, "geo": {"confidence": 0.0, "lat": 48.8596266, "lon": 2.3867017, "precision": "address"}, "images": [], "listing_url": "https://www.seloger.com/annonces/achat/appartement/paris-11eme-75/leon-blum-folie-regnault/256924993.htm", "location_hint": {"address_text": "L\u00e9on-Blum Folie-Regnault, Paris 11\u00e8me, 75011", "arrondissement_text": "L\u00e9on-Blum Folie-Regnault", "confidence": 0.0, "poi_or_station": null, "quartier_text": null, "walk_minutes_to_poi": null}, "photos": ["https://mms.seloger.com/8/d/2/b/8d2b9648-42f6-44e3-9e87-d6573a2a59f6.jpg?ci_seal=181ab70aa3027bf7f936f85241104b094fedad5b\u0026w=1024\u0026h=576", "https://mms.seloger.com/4/8/c/7/48c79c4e-e378-4569-b00a-221d5ee3f675.jpg?ci_seal=8d82c01cf160fc23933ef92b698cee82acd8cc6e\u0026w=1024\u0026h=576", "https://mms.seloger.com/3/c/0/8/3c083d52-2b24-4c49-98da-6a1faa06fdc6.jpg?ci_seal=037551b95969e58cbd71a5c22ca228204357990a\u0026w=1024\u0026h=576"], "price_eur": 420000, "property_condition": {"is_new": null, "is_old": null, "year_built": null}, "raw_text": null, "rooms": 2.0, "source": "seloger", "surface_m2": 42.2, "title": "Appartement 2 pi\u00e8ces"}, {"building": {"floor": null, "is_ground_floor": null}, "commute": {"computed_from": "address", "minutes_total": 45, "minutes_transit_only": 45, "mode": "transit", "notes": null}, "derived": {"arrondissement": "75018", "price_per_m2": 12467.5, "quartier": "Grandes-Carrieres"}, "description": null, "dvf_bonus": {"delta_vs_ref_pct": 44.8, "price_m2_ref": 8610.0, "ref_level": "arrondissement"}, "energy": {"dpe_letter": null}, "geo": {"confidence": 0.0, "lat": 48.8867148, "lon": 2.3388895, "precision": "address"}, "images": [], "listing_url": "https://www.seloger.com/annonces/achat/appartement/paris-18eme-75/montmartre/256077399.htm", "location_hint": {"address_text": "Montmartre, Paris 18\u00e8me, 75018", "arrondissement_text": "Montmartre", "confidence": 0.0, "poi_or_station": null, "quartier_text": null, "walk_minutes_to_poi": null}, "photos": ["https://mms.seloger.com/8/d/f/9/8df9ab29-72e3-4d3f-98e4-be5af50c071e.jpg?ci_seal=4e7f5e3e277522320133289f8d221ecac5e5cb9d\u0026w=1024\u0026h=576", "https://mms.seloger.com/a/c/2/a/ac2a1daf-491a-451b-9114-be9f7f2ed9f2.jpg?ci_seal=05e64573d000284b0bef8761f034746be92af7b2\u0026w=1024\u0026h=576", "https://mms.seloger.com/4/8/d/5/48d56682-541b-47a7-84c8-cff6223d6510.jpg?ci_seal=79bbcfc63a6bdcc710fcd8d79af83ac925c41127\u0026w=1024\u0026h=576"], "price_eur": 498700, "property_condition": {"is_new": null, "is_old": null, "year_built": null}, "raw_text": null, "rooms": 2.0, "source": "seloger", "surface_m2": 40.0, "title": "Appartement atypique au pied de Montmartre"}, {"building": {"floor": null, "is_ground_floor": null}, "commute": {"computed_from": "address", "minutes_total": 27, "minutes_transit_only": 27, "mode": "transit", "notes": null}, "derived": {"arrondissement": "75015", "price_per_m2": 7207.79, "quartier": "Saint-Lambert"}, "description": null, "dvf_bonus": {"delta_vs_ref_pct": -23.17, "price_m2_ref": 9381.0, "ref_level": "arrondissement"}, "energy": {"dpe_letter": null}, "geo": {"confidence": 0.0, "lat": 48.8364973, "lon": 2.3081428, "precision": "address"}, "images": [], "listing_url": "https://www.seloger.com/annonces/achat/appartement/paris-15eme-75/alleray-procession/254257585.htm", "location_hint": {"address_text": "Alleray Procession, Paris 15\u00e8me, 75015", "arrondissement_text": "Alleray Procession", "confidence": 0.0, "poi_or_station": null, "quartier_text": null, "walk_minutes_to_poi": null}, "photos": ["https://mms.seloger.com/1/f/7/0/1f702287-4b94-4ea3-9f9e-38b415ec0f81.jpg?ci_seal=f14e91e5476b760d9465abfed4e69f0f6b624467\u0026w=1024\u0026h=576", "https://mms.seloger.com/e/3/0/3/e3035291-817e-4e10-9c06-329caaa1a710.jpg?ci_seal=bd7de540577da5b6ce3aa7207e8dcd60096c9002\u0026w=1024\u0026h=576", "https://mms.seloger.com/5/f/4/3/5f43441b-f630-4168-ac48-1bd4608e8945.jpg?ci_seal=b96debfeb8d276bdd51a632eecc2c04cb8b84cd0\u0026w=1024\u0026h=576", "https://mms.seloger.com/1/6/1/a/161a30d2-6649-471a-ba38-409d12c06f44.jpg?ci_seal=2dfdf2630ce6656e29ff43acd5e4d2b7cfe48688\u0026w=768\u0026h=560"], "price_eur": 444000, "property_condition": {"is_new": null, "is_old": null, "year_built": null}, "raw_text": null, "rooms": 3.0, "source": "seloger", "surface_m2": 61.6, "title": "Appartement \u00c0 Vendre"}, {"building": {"floor": null, "is_ground_floor": null}, "commute": {"computed_from": "address", "minutes_total": 34, "minutes_transit_only": 34, "mode": "transit", "notes": null}, "derived": {"arrondissement": "75015", "price_per_m2": 9423.08, "quartier": "Saint-Lambert"}, "description": null, "dvf_bonus": {"delta_vs_ref_pct": 0.45, "price_m2_ref": 9381.0, "ref_level": "arrondissement"}, "energy": {"dpe_letter": null}, "geo": {"confidence": 0.0, "lat": 48.8344576, "lon": 2.3005597, "precision": "address"}, "images": [], "listing_url": "https://www.seloger.com/annonces/achat/appartement/paris-6eme-75/rennes/256528999.htm", "location_hint": {"address_text": "Saint Lambert, Paris 15\u00e8me, 75015", "arrondissement_text": "Saint Lambert", "confidence": 0.0, "poi_or_station": null, "quartier_text": null, "walk_minutes_to_poi": null}, "photos": ["https://mms.seloger.com/8/7/b/7/87b789f9-ad1e-480f-ba54-d6227d995637.jpg?ci_seal=548cabf9fc340359186db2699209f703a602fe1c\u0026w=1024\u0026h=576", "https://mms.seloger.com/c/4/f/3/c4f39c17-b447-4d1b-be33-f46f37f6b529.jpg?ci_seal=d24b045ca73db1f02abe1405461dd86e5b613b82\u0026w=1024\u0026h=576", "https://mms.seloger.com/f/9/2/6/f92671d3-9ee5-4a46-9aed-b15770ae905a.jpg?ci_seal=564a7a8cd2872508164f90bae15ab054447cdf57\u0026w=1024\u0026h=576"], "price_eur": 490000, "property_condition": {"is_new": null, "is_old": null, "year_built": null}, "raw_text": null, "rooms": 2.0, "source": "seloger", "surface_m2": 52.0, "title": "PARIS 15 - CONVENTION / VAUGIRARD - 2 PIECES - 1 CHAMBRE"}, {"building": {"floor": null, "is_ground_floor": null}, "commute": {"computed_from": "address", "minutes_total": 27, "minutes_transit_only": 27, "mode": "transit", "notes": null}, "derived": {"arrondissement": "75015", "price_per_m2": 9000.0, "quartier": "Saint-Lambert"}, "description": null, "dvf_bonus": {"delta_vs_ref_pct": -4.06, "price_m2_ref": 9381.0, "ref_level": "arrondissement"}, "energy": {"dpe_letter": null}, "geo": {"confidence": 0.0, "lat": 48.8364973, "lon": 2.3081428, "precision": "address"}, "images": [], "listing_url": "https://www.seloger.com/annonces/achat/appartement/paris-15eme-75/alleray-procession/252690871.htm", "location_hint": {"address_text": "Alleray Procession, Paris 15\u00e8me, 75015", "arrondissement_text": "Alleray Procession", "confidence": 0.0, "poi_or_station": null, "quartier_text": null, "walk_minutes_to_poi": null}, "photos": ["https://mms.seloger.com/f/d/4/b/fd4b54dc-4a59-4748-8d74-145bf8119ad1.jpg?ci_seal=578371678192ca21eeaf524cd6ca225f34d9af1b\u0026w=1024\u0026h=576", "https://mms.seloger.com/c/a/b/c/cabce37d-5630-438d-b172-8ffac84fa26e.jpg?ci_seal=3aa23db5ea57195cb9701122f7cd69d401db7280\u0026w=1024\u0026h=576", "https://mms.seloger.com/d/9/3/b/d93bf5ec-7dc1-42f7-9160-b9f5bc28b439.jpg?ci_seal=b8f0d153e51dc18615596cd0e572b4d59128bf55\u0026w=1024\u0026h=576", "https://mms.seloger.com/8/7/8/5/8785a392-67cd-486b-8987-8a47e4101fe3.jpg?ci_seal=4830ab218507097677273daba7e7c10b68af8f47\u0026w=768\u0026h=560"], "price_eur": 450000, "property_condition": {"is_new": null, "is_old": null, "year_built": null}, "raw_text": null, "rooms": 3.0, "source": "seloger", "surface_m2": 50.0, "title": "Paris XV - 3 pi\u00e8ces"}, {"building": {"floor": null, "is_ground_floor": null}, "commute": {"computed_from": "address", "minutes_total": 49, "minutes_transit_only": 49, "mode": "transit", "notes": null}, "derived": {"arrondissement": "75010", "price_per_m2": 7456.14, "quartier": "Saint-Vincent-de-Paul"}, "description": null, "dvf_bonus": {"delta_vs_ref_pct": -18.34, "price_m2_ref": 9131.0, "ref_level": "arrondissement"}, "energy": {"dpe_letter": null}, "geo": {"confidence": 0.0, "lat": 48.881203, "lon": 2.365158, "precision": "address"}, "images": [], "listing_url": "https://www.seloger.com/annonces/achat/appartement/paris-10eme-75/louis-blanc-aqueduc/256917515.htm", "location_hint": {"address_text": "Louis Blanc-Aqueduc, Paris 10\u00e8me, 75010", "arrondissement_text": "Louis Blanc-Aqueduc", "confidence": 0.0, "poi_or_station": null, "quartier_text": null, "walk_minutes_to_poi": null}, "photos": ["https://mms.seloger.com/f/b/f/a/fbfa21fc-aad6-49c9-8f49-99fb7079b5fe.jpg?ci_seal=0cfbe0c153d40623ff9c342048614a161bfa5e64\u0026w=1024\u0026h=576", "https://mms.seloger.com/c/5/a/c/c5ac37af-168f-425e-a71a-f95be61ada35.jpg?ci_seal=4179da446c1614c3f89892cdcfa6d83fe227199a\u0026w=1024\u0026h=576", "https://mms.seloger.com/b/4/0/c/b40c1cba-368e-4dbf-8e0d-5f4de979fd2d.jpg?ci_seal=8c9c15ef038a43dfbc94b9b54fc44ecc966c6c9b\u0026w=1024\u0026h=576"], "price_eur": 425000, "property_condition": {"is_new": null, "is_old": null, "year_built": null}, "raw_text": null, "rooms": 2.0, "source": "seloger", "surface_m2": 57.0, "title": "Vente Appartement 2 pi\u00e8ces"}, {"building": {"floor": null, "is_ground_floor": null}, "commute": {"computed_from": "address", "minutes_total": 38, "minutes_transit_only": 38, "mode": "transit", "notes": null}, "derived": {"arrondissement": "75004", "price_per_m2": 12170.73, "quartier": "Saint-Merri"}, "description": null, "dvf_bonus": {"delta_vs_ref_pct": -2.53, "price_m2_ref": 12487.0, "ref_level": "arrondissement"}, "energy": {"dpe_letter": null}, "geo": {"confidence": 0.0, "lat": 48.8573399, "lon": 2.3515768, "precision": "address"}, "images": [], "listing_url": "https://www.seloger.com/annonces/achat/appartement/paris-4eme-75/saint-merri/254854051.htm", "location_hint": {"address_text": "Saint Merri, Paris 4\u00e8me, 75004", "arrondissement_text": "Saint Merri", "confidence": 0.0, "poi_or_station": null, "quartier_text": null, "walk_minutes_to_poi": null}, "photos": ["https://mms.seloger.com/5/3/2/3/53231bc1-af31-434b-b59d-3b18c9c2c15c.jpg?ci_seal=8cd71176b0dbfd93639669fcbcad62df5d12f72f\u0026w=1024\u0026h=576", "https://mms.seloger.com/e/b/7/7/eb77fdd5-7404-43d5-bb69-0d6dd861c6a5.jpg?ci_seal=21acc31f38e02726b416e6c46294d4896b77598c\u0026w=1024\u0026h=576", "https://mms.seloger.com/2/c/c/d/2ccd5fac-af45-4607-8c07-afaf1f0e2e36.jpg?ci_seal=b4c45e8c8872aa0f599515def0a813a0658aa2d6\u0026w=1024\u0026h=576", "https://mms.seloger.com/6/d/7/7/6d77dfd5-9122-4bcf-9486-ea1cb877afd7.jpg?ci_seal=3eaaddebbdfcf4ef01f818022c0d9fb25a64bb0a\u0026w=768\u0026h=560"], "price_eur": 499000, "property_condition": {"is_new": null, "is_old": null, "year_built": null}, "raw_text": null, "rooms": 2.0, "source": "seloger", "surface_m2": 41.0, "title": "Rue du Temple  41 m\u00b2, 2\u00e8me \u00e9tage"}, {"building": {"floor": null, "is_ground_floor": null}, "commute": {"computed_from": "address", "minutes_total": 25, "minutes_transit_only": 25, "mode": "transit", "notes": null}, "derived": {"arrondissement": "75015", "price_per_m2": 8490.57, "quartier": "Saint-Lambert"}, "description": null, "dvf_bonus": {"delta_vs_ref_pct": -9.49, "price_m2_ref": 9381.0, "ref_level": "arrondissement"}, "energy": {"dpe_letter": null}, "geo": {"confidence": 0.0, "lat": 48.8421616, "lon": 2.2927665, "precision": "address"}, "images": [], "listing_url": "https://www.seloger.com/annonces/achat/appartement/paris-15eme-75/255932741.htm", "location_hint": {"address_text": "Paris 15\u00e8me, 75015", "arrondissement_text": null, "confidence": 0.0, "poi_or_station": null, "quartier_text": null, "walk_minutes_to_poi": null}, "photos": ["https://mms.seloger.com/4/0/0/b/400be622-4622-44d6-aca1-c8efb56c8d81.jpg?ci_seal=b930690860273ac534e1c3cfdcf99ecfa13072f7\u0026w=1024\u0026h=576", "https://mms.seloger.com/8/5/8/2/8582c850-2ae1-4b2a-8866-e76f635b1591.jpg?ci_seal=1e5453a334aa5c7eb9f6141afa400c1ee534a34c\u0026w=1024\u0026h=576", "https://mms.seloger.com/0/7/6/a/076a95f3-c983-4191-818d-0a4e9d993867.jpg?ci_seal=6759f759d4f2da4369dbf6d6e889676a6faf6243\u0026w=1024\u0026h=576", "https://mms.seloger.com/c/1/1/1/c111b8c1-3816-42c5-8c41-af83c43926fa.jpg?ci_seal=924fcfb25ff0bba079e44fc7e05477699ee1e446\u0026w=768\u0026h=560"], "price_eur": 450000, "property_condition": {"is_new": null, "is_old": null, "year_built": null}, "raw_text": null, "rooms": 2.0, "source": "seloger", "surface_m2": 53.0, "title": "A r\u00e9nover ! 2 pi\u00e8ces de 50 m\u00b2 - Balcon et parking - Rue Labroust"}, {"building": {"floor": null, "is_ground_floor": null}, "commute": {"computed_from": "address", "minutes_total": 52, "minutes_transit_only": 52, "mode": "transit", "notes": null}, "derived": {"arrondissement": "75011", "price_per_m2": 9676.47, "quartier": "Folie-Mericourt"}, "description": null, "dvf_bonus": {"delta_vs_ref_pct": -1.66, "price_m2_ref": 9840.0, "ref_level": "arrondissement"}, "energy": {"dpe_letter": null}, "geo": {"confidence": 0.0, "lat": 48.8563342, "lon": 2.3944206, "precision": "address"}, "images": [], "listing_url": "https://www.seloger.com/annonces/achat/appartement/paris-11eme-75/nation-alexandre-dumas/254489145.htm", "location_hint": {"address_text": "Nation-Alexandre Dumas, Paris 11\u00e8me, 75011", "arrondissement_text": "Nation-Alexandre Dumas", "confidence": 0.0, "poi_or_station": null, "quartier_text": null, "walk_minutes_to_poi": null}, "photos": ["https://mms.seloger.com/d/7/6/1/d761b039-e2c8-4f9d-8bce-44415f2d9a44.jpg?ci_seal=24f7766263183d6a5f26f337179105c828f6063e\u0026w=1024\u0026h=576", "https://mms.seloger.com/5/2/7/2/5272e49f-d93a-458d-a4c8-506ab7cb482b.jpg?ci_seal=92b74e7d2d568906d0db62c456188f3faf6f8ed1\u0026w=1024\u0026h=576", "https://mms.seloger.com/a/9/3/d/a93d1e68-96eb-49d7-91af-5157af1111f9.jpg?ci_seal=342f2b94bbff6a7f16d008286257137e9b478738\u0026w=1024\u0026h=576"], "price_eur": 329000, "property_condition": {"is_new": null, "is_old": null, "year_built": null}, "raw_text": null, "rooms": 2.0, "source": "seloger", "surface_m2": 34.0, "title": "Appartement 2 pi\u00e8ces 34m2"}, {"building": {"floor": null, "is_ground_floor": null}, "commute": {"computed_from": "address", "minutes_total": 38, "minutes_transit_only": 38, "mode": "transit", "notes": null}, "derived": {"arrondissement": "75017", "price_per_m2": 10531.91, "quartier": "Ternes"}, "description": null, "dvf_bonus": {"delta_vs_ref_pct": 5.32, "price_m2_ref": 10000.0, "ref_level": "arrondissement"}, "energy": {"dpe_letter": null}, "geo": {"confidence": 0.0, "lat": 48.89280549999999, "lon": 2.3277735, "precision": "address"}, "images": [], "listing_url": "https://www.seloger.com/annonces/achat/appartement/paris-17eme-75/la-fourche-guy-moquet/255156143.htm", "location_hint": {"address_text": "La Fourche-Guy M\u00f4quet, Paris 17\u00e8me, 75017", "arrondissement_text": "La Fourche-Guy M\u00f4quet", "confidence": 0.0, "poi_or_station": null, "quartier_text": null, "walk_minutes_to_poi": null}, "photos": ["https://mms.seloger.com/e/4/5/0/e450f39b-14dc-4f69-bc41-417082e6be84.jpg?ci_seal=47f4fc6317deb8ad3af08129299a853e610fba6d\u0026w=1024\u0026h=576", "https://mms.seloger.com/1/b/c/f/1bcfea6c-0711-47e0-ab58-91018df8e743.jpg?ci_seal=3049559bd21935e1ecb204f762f4843c718e2526\u0026w=1024\u0026h=576", "https://mms.seloger.com/a/0/a/e/a0aed5a7-8d1e-41a9-aa05-ddc5b766993a.jpg?ci_seal=43e90a8a610a34a4fc7959cbb04ac36ec2a56e9e\u0026w=1024\u0026h=576"], "price_eur": 495000, "property_condition": {"is_new": null, "is_old": null, "year_built": null}, "raw_text": null, "rooms": 3.0, "source": "seloger", "surface_m2": 47.0, "title": "Paris XVII-Epinettes - Appartement 3 pi\u00e8ces - Balcon sans vis-\u00e0-"}, {"building": {"floor": null, "is_ground_floor": null}, "commute": {"computed_from": "address", "minutes_total": 43, "minutes_transit_only": 43, "mode": "transit", "notes": null}, "derived": {"arrondissement": "75015", "price_per_m2": 7764.58, "quartier": "Saint-Lambert"}, "description": null, "dvf_bonus": {"delta_vs_ref_pct": -17.23, "price_m2_ref": 9381.0, "ref_level": "arrondissement"}, "energy": {"dpe_letter": null}, "geo": {"confidence": 0.0, "lat": 48.8300389, "lon": 2.2904507, "precision": "address"}, "images": [], "listing_url": "https://www.seloger.com/annonces/achat/appartement/paris-15eme-75/vaugirard-parc-des-expositions/244486263.htm", "location_hint": {"address_text": "Vaugirard-Parc des Expositions, Paris 15\u00e8me, 75015", "arrondissement_text": "Vaugirard-Parc des Expositions", "confidence": 0.0, "poi_or_station": null, "quartier_text": null, "walk_minutes_to_poi": null}, "photos": ["https://mms.seloger.com/5/5/2/3/5523eb04-cba0-4b90-b1b3-198539bab79a.jpg?ci_seal=643597058c650026ab9f4be50988be5e82865836\u0026w=1024\u0026h=576", "https://mms.seloger.com/0/3/5/d/035d8424-8570-4d3d-8f29-8058562504f2.jpg?ci_seal=98aaf4c7ef04bf20955eac3c803bae65b95cef0c\u0026w=1024\u0026h=576", "https://mms.seloger.com/2/3/8/d/238d1dc4-99ca-438e-b4a1-57d640511cf4.jpg?ci_seal=37e32cccba3fd1b690b612aec6ce5b50d822bce3\u0026w=1024\u0026h=576"], "price_eur": 359500, "property_condition": {"is_new": null, "is_old": null, "year_built": null}, "raw_text": null, "rooms": 2.0, "source": "seloger", "surface_m2": 46.3, "title": "Appartement 2 pi\u00e8ces 46 m\u00b2 - Paris 15 M\u00e9tro Lourmel"}, {"building": {"floor": null, "is_ground_floor": null}, "commute": {"computed_from": "address", "minutes_total": 20, "minutes_transit_only": 20, "mode": "transit", "notes": null}, "derived": {"arrondissement": "75015", "price_per_m2": 9745.1, "quartier": "Saint-Lambert"}, "description": null, "dvf_bonus": {"delta_vs_ref_pct": 3.88, "price_m2_ref": 9381.0, "ref_level": "arrondissement"}, "energy": {"dpe_letter": null}, "geo": {"confidence": 0.0, "lat": 48.8498836, "lon": 2.2865039, "precision": "address"}, "images": [], "listing_url": "https://www.seloger.com/annonces/achat/appartement/paris-15eme-75/emeriau-zola/234510597.htm", "location_hint": {"address_text": "Emeriau-Zola, Paris 15\u00e8me, 75015", "arrondissement_text": "Emeriau-Zola", "confidence": 0.0, "poi_or_station": null, "quartier_text": null, "walk_minutes_to_poi": null}, "photos": ["https://mms.seloger.com/a/8/0/7/a80718f8-37a6-4350-be3a-c79ff40f7bae.jpg?ci_seal=3207d08780d511d26d9c3661a221940c2e915205\u0026w=1024\u0026h=576", "https://mms.seloger.com/0/9/1/6/09161093-f8a3-4a92-bbdb-37a04d391eef.jpg?ci_seal=4a4765586c126155086f4d4dc766300a9fbf1559\u0026w=1024\u0026h=576", "https://mms.seloger.com/c/2/9/8/c29889aa-11b6-4d4b-bf8e-1c2a62d5b9ed.jpg?ci_seal=e69ab98a5aafebfe66934b696b9b5c38634fbb71\u0026w=1024\u0026h=576"], "price_eur": 497000, "property_condition": {"is_new": null, "is_old": null, "year_built": null}, "raw_text": null, "rooms": 2.0, "source": "seloger", "surface_m2": 51.0, "title": "DEUX PIECES METRO Duplex Ligne 6 Lourmel / Viala:"}, {"building": {"floor": null, "is_ground_floor": null}, "commute": {"computed_from": "address", "minutes_total": 48, "minutes_transit_only": 48, "mode": "transit", "notes": null}, "derived": {"arrondissement": "75018", "price_per_m2": 7931.82, "quartier": "Grandes-Carrieres"}, "description": null, "dvf_bonus": {"delta_vs_ref_pct": -7.88, "price_m2_ref": 8610.0, "ref_level": "arrondissement"}, "energy": {"dpe_letter": null}, "geo": {"confidence": 0.0, "lat": 48.89365799999999, "lon": 2.347936, "precision": "address"}, "images": [], "listing_url": "https://www.seloger.com/annonces/achat/appartement/paris-18eme-75/amiraux-simplon-poissonniers/256939939.htm", "location_hint": {"address_text": "Amiraux-Simplon-Poissonniers, Paris 18\u00e8me, 75018", "arrondissement_text": "Amiraux-Simplon-Poissonniers", "confidence": 0.0, "poi_or_station": null, "quartier_text": null, "walk_minutes_to_poi": null}, "photos": ["https://mms.seloger.com/9/6/1/5/9615588f-6672-465b-b4cd-ff57a1ac6b6f.jpg?ci_seal=737155ed20d046b73505fc4de97750f03138d657\u0026w=1024\u0026h=576", "https://mms.seloger.com/2/3/a/d/23adbac9-f11d-45a5-b45a-0ee6e329c78c.jpg?ci_seal=7dee2b226c16a91abd7089c0fbda6e5bc0cf3129\u0026w=1024\u0026h=576", "https://mms.seloger.com/9/b/d/7/9bd7811f-2f8e-4929-a30d-baae524e04ea.jpg?ci_seal=87b73a52f69e33dfc4e9002d9cc094e11a1394ac\u0026w=1024\u0026h=576"], "price_eur": 349000, "property_condition": {"is_new": null, "is_old": null, "year_built": null}, "raw_text": null, "rooms": 3.0, "source": "seloger", "surface_m2": 44.0, "title": "Coup de Coeur"}, {"building": {"floor": null, "is_ground_floor": null}, "commute": {"computed_from": "address", "minutes_total": 48, "minutes_transit_only": 48, "mode": "transit", "notes": null}, "derived": {"arrondissement": "75011", "price_per_m2": 9560.23, "quartier": "Folie-Mericourt"}, "description": null, "dvf_bonus": {"delta_vs_ref_pct": -2.84, "price_m2_ref": 9840.0, "ref_level": "arrondissement"}, "energy": {"dpe_letter": null}, "geo": {"confidence": 0.0, "lat": 48.8728179, "lon": 2.389461, "precision": "address"}, "images": [], "listing_url": "https://www.seloger.com/annonces/achat/appartement/paris-11eme-75/belleville-saint-maur/253709239.htm", "location_hint": {"address_text": "Belleville-Saint Maur, Paris 11\u00e8me, 75011", "arrondissement_text": "Belleville-Saint Maur", "confidence": 0.0, "poi_or_station": null, "quartier_text": null, "walk_minutes_to_poi": null}, "photos": ["https://mms.seloger.com/d/3/1/c/d31c193d-a65a-4e51-b9e5-5bd8c53deb7c.jpg?ci_seal=e8b4cff72ee61badcdf4456267b746b98eabed57\u0026w=1024\u0026h=576", "https://mms.seloger.com/1/3/8/a/138a0989-5f37-4bda-a7b1-92f18a9cc3ff.jpg?ci_seal=85d82f20741c459d9ea71ad6437ab9ba78032992\u0026w=1024\u0026h=576", "https://mms.seloger.com/7/9/c/c/79ccdb68-9484-4bbf-b36b-18c54707aeb6.jpg?ci_seal=fc6ce7f5da7b7c8d1aca698aa08589d24e9eea7d\u0026w=1024\u0026h=576"], "price_eur": 500000, "property_condition": {"is_new": null, "is_old": null, "year_built": null}, "raw_text": null, "rooms": 2.0, "source": "seloger", "surface_m2": 52.3, "title": "Paris 11e \u2013 Belleville \u2013 Loft r\u00e9nov\u00e9 par architecte \u2013 Calme"}, {"building": {"floor": null, "is_ground_floor": null}, "commute": {"computed_from": "address", "minutes_total": 43, "minutes_transit_only": 43, "mode": "transit", "notes": null}, "derived": {"arrondissement": "75015", "price_per_m2": 9024.39, "quartier": "Saint-Lambert"}, "description": null, "dvf_bonus": {"delta_vs_ref_pct": -3.8, "price_m2_ref": 9381.0, "ref_level": "arrondissement"}, "energy": {"dpe_letter": null}, "geo": {"confidence": 0.0, "lat": 48.8300389, "lon": 2.2904507, "precision": "address"}, "images": [], "listing_url": "https://www.seloger.com/annonces/achat/appartement/paris-15eme-75/vaugirard-parc-des-expositions/256683391.htm", "location_hint": {"address_text": "Vaugirard-Parc des Expositions, Paris 15\u00e8me, 75015", "arrondissement_text": "Vaugirard-Parc des Expositions", "confidence": 0.0, "poi_or_station": null, "quartier_text": null, "walk_minutes_to_poi": null}, "photos": ["https://mms.seloger.com/5/d/2/3/5d2347ea-3f88-4232-ba22-7b2f2b717697.jpg?ci_seal=4bdf971589fdcd33c7bde3d5241d8385911c62b4\u0026w=1024\u0026h=576", "https://mms.seloger.com/b/5/0/f/b50fe0b1-4a1c-465a-85f3-7abc17608c2b.jpg?ci_seal=157ea831b09e5ea6f957ad18604ce6b36d19e81d\u0026w=1024\u0026h=576", "https://mms.seloger.com/d/f/5/5/df55a8de-1c45-470b-b128-d2077e9843f9.jpg?ci_seal=2ca171c5f1ae54631af5bf6a751e0327d4c87984\u0026w=1024\u0026h=576", "https://mms.seloger.com/a/c/9/a/ac9a9157-1dce-4e1f-9679-997458332ee8.jpg?ci_seal=3f6307ffc22e84a2969a98f71efa5f9c128d30ee\u0026w=768\u0026h=560"], "price_eur": 370000, "property_condition": {"is_new": null, "is_old": null, "year_built": null}, "raw_text": null, "rooms": 3.0, "source": "seloger", "surface_m2": 41.0, "title": "75015, Appartement 3 pi\u00e8ces 41m\u00b2 lumineux"}, {"building": {"floor": null, "is_ground_floor": null}, "commute": {"computed_from": "address", "minutes_total": 44, "minutes_transit_only": 44, "mode": "transit", "notes": null}, "derived": {"arrondissement": "75010", "price_per_m2": 9213.05, "quartier": "Saint-Vincent-de-Paul"}, "description": null, "dvf_bonus": {"delta_vs_ref_pct": 0.9, "price_m2_ref": 9131.0, "ref_level": "arrondissement"}, "energy": {"dpe_letter": null}, "geo": {"confidence": 0.0, "lat": 48.8828135, "lon": 2.3529947, "precision": "address"}, "images": [], "listing_url": "https://www.seloger.com/annonces/achat/appartement/paris-10eme-75/saint-vincent-de-paul-lariboisiere/254806413.htm", "location_hint": {"address_text": "Saint Vincent de Paul-Lariboisi\u00e8re, Paris 10\u00e8me, 75010", "arrondissement_text": "Saint Vincent de Paul-Lariboisi\u00e8re", "confidence": 0.0, "poi_or_station": null, "quartier_text": null, "walk_minutes_to_poi": null}, "photos": ["https://mms.seloger.com/e/c/2/8/ec286627-8cd8-4274-b004-58844f36d0ed.jpg?ci_seal=c10bac1f9c351193809906321505f6026e06c1d7\u0026w=1024\u0026h=576", "https://mms.seloger.com/1/4/2/4/14242a67-6760-4738-8fe6-17dacfaf9d2c.jpg?ci_seal=4221ff718e034078b533293253f6135028ecef84\u0026w=1024\u0026h=576", "https://mms.seloger.com/b/8/e/5/b8e5b4d6-00b4-4973-9f28-10215713e944.jpg?ci_seal=f6b7261ed881f81f3b29642ce2b3f983077f24d8\u0026w=1024\u0026h=576"], "price_eur": 480000, "property_condition": {"is_new": null, "is_old": null, "year_built": null}, "raw_text": null, "rooms": 3.0, "source": "seloger", "surface_m2": 52.1, "title": "RUE LA FAYETTE - PARIS 10E"}, {"building": {"floor": null, "is_ground_floor": null}, "commute": {"computed_from": "address", "minutes_total": 42, "minutes_transit_only": 42, "mode": "transit", "notes": null}, "derived": {"arrondissement": "75009", "price_per_m2": 13164.89, "quartier": "Saint-Georges"}, "description": null, "dvf_bonus": {"delta_vs_ref_pct": 25.07, "price_m2_ref": 10526.0, "ref_level": "arrondissement"}, "energy": {"dpe_letter": null}, "geo": {"confidence": 0.0, "lat": 48.8739189, "lon": 2.3367386, "precision": "address"}, "images": [], "listing_url": "https://www.seloger.com/annonces/achat/appartement/paris-9eme-75/provence-opera/255446099.htm", "location_hint": {"address_text": "Provence Op\u00e9ra, Paris 9\u00e8me, 75009", "arrondissement_text": "Provence Op\u00e9ra", "confidence": 0.0, "poi_or_station": null, "quartier_text": null, "walk_minutes_to_poi": null}, "photos": ["https://mms.seloger.com/b/b/3/f/bb3f8075-b0ea-4556-b5c5-295f9bec7163.jpg?ci_seal=cd175ac081b2288f63003962d25560866ab80976\u0026w=1024\u0026h=576", "https://mms.seloger.com/a/7/f/1/a7f157bd-17ae-48fd-8826-61a2db3188cb.jpg?ci_seal=c9291a1125d091fc8d043c708ede9427d4bd4063\u0026w=1024\u0026h=576", "https://mms.seloger.com/b/1/e/5/b1e5ff1d-fafc-400f-b02e-280425b33ab0.jpg?ci_seal=9d8b1df14dd5c673650a9fd27453790e64c28007\u0026w=1024\u0026h=576", "https://mms.seloger.com/d/2/0/5/d205a2ac-1dc4-44de-8b1c-8509b633b727.jpg?ci_seal=549811344d82510bbdf3f3b16c2cd9f786f81737\u0026w=768\u0026h=560"], "price_eur": 495000, "property_condition": {"is_new": null, "is_old": null, "year_built": null}, "raw_text": null, "rooms": 2.0, "source": "seloger", "surface_m2": 37.6, "title": "Appartement"}, {"building": {"floor": null, "is_ground_floor": null}, "commute": {"computed_from": "address", "minutes_total": 49, "minutes_transit_only": 49, "mode": "transit", "notes": null}, "derived": {"arrondissement": "75010", "price_per_m2": 8713.64, "quartier": "Saint-Vincent-de-Paul"}, "description": null, "dvf_bonus": {"delta_vs_ref_pct": -4.57, "price_m2_ref": 9131.0, "ref_level": "arrondissement"}, "energy": {"dpe_letter": null}, "geo": {"confidence": 0.0, "lat": 48.881203, "lon": 2.365158, "precision": "address"}, "images": [], "listing_url": "https://www.seloger.com/annonces/achat/appartement/paris-10eme-75/louis-blanc-aqueduc/256659609.htm", "location_hint": {"address_text": "Louis Blanc-Aqueduc, Paris 10\u00e8me, 75010", "arrondissement_text": "Louis Blanc-Aqueduc", "confidence": 0.0, "poi_or_station": null, "quartier_text": null, "walk_minutes_to_poi": null}, "photos": ["https://mms.seloger.com/4/b/4/9/4b491c79-3e19-496b-8556-06e42fb58491.jpg?ci_seal=ac7483b7c0a855b23b9bf3c2e518807e01bac59a\u0026w=1024\u0026h=576", "https://mms.seloger.com/f/4/a/a/f4aa8c27-7835-4b06-839c-6c437181854d.jpg?ci_seal=3210eaa73361357ff277b8098d3b0e90d38789ae\u0026w=1024\u0026h=576", "https://mms.seloger.com/a/d/b/7/adb7dc8f-f23a-4a90-9374-3298b68aac1e.jpg?ci_seal=472ed6780dd27d64c9fe1536597a72db6deb4bc6\u0026w=1024\u0026h=576", "https://mms.seloger.com/2/6/a/9/26a9b46c-5d7f-4dde-9704-d0a57110d6d3.jpg?ci_seal=6b25271528404d6ec8fa3d4f9a175cd83f933eca\u0026w=768\u0026h=560"], "price_eur": 479250, "property_condition": {"is_new": null, "is_old": null, "year_built": null}, "raw_text": null, "rooms": 2.0, "source": "seloger", "surface_m2": 55.0, "title": "Appartement 2 pi\u00e8ces R\u00e9sidence La Fayette"}, {"building": {"floor": null, "is_ground_floor": null}, "commute": {"computed_from": "address", "minutes_total": 33, "minutes_transit_only": 33, "mode": "transit", "notes": null}, "derived": {"arrondissement": "75010", "price_per_m2": 12573.1, "quartier": "Saint-Vincent-de-Paul"}, "description": null, "dvf_bonus": {"delta_vs_ref_pct": 37.7, "price_m2_ref": 9131.0, "ref_level": "arrondissement"}, "energy": {"dpe_letter": null}, "geo": {"confidence": 0.0, "lat": 48.8698004, "lon": 2.352704, "precision": "address"}, "images": [], "listing_url": "https://www.seloger.com/annonces/achat/appartement/paris-9eme-75/trudaine-maubeuge/255225673.htm", "location_hint": {"address_text": "Porte Saint Denis-Paradis, Paris 10\u00e8me, 75010", "arrondissement_text": "Porte Saint Denis-Paradis", "confidence": 0.0, "poi_or_station": null, "quartier_text": null, "walk_minutes_to_poi": null}, "photos": ["https://mms.seloger.com/a/4/b/c/a4bc15a5-265e-41f0-9546-16918ed676ac.jpg?ci_seal=38317f1655440bd5f7db7fc7bb2b08ee5faa0fd5\u0026w=1024\u0026h=576", "https://mms.seloger.com/5/4/7/9/54790527-e10d-4a61-b4a2-e9f9ef10e8c0.jpg?ci_seal=6a8ac54f72894b88fb79e44446f9a3d1a6189a0c\u0026w=1024\u0026h=576", "https://mms.seloger.com/a/a/e/f/aaef29ae-6c70-44f1-b8bb-6cc93e5f0a77.jpg?ci_seal=33f6246cc561f46ff68c9219c4a90978e12adb67\u0026w=1024\u0026h=576", "https://mms.seloger.com/7/2/3/9/72394933-4446-4e6d-badc-20d8d6248843.jpg?ci_seal=181d8d3533cfbf3299177c08392ee2fe62b67dc0\u0026w=768\u0026h=560"], "price_eur": 430000, "property_condition": {"is_new": null, "is_old": null, "year_built": null}, "raw_text": null, "rooms": 2.0, "source": "seloger", "surface_m2": 34.2, "title": "Paris 10e \u2013 RUE D\u0027HAUTEVILLE \u2013 Appartement \u00e0 vendre \u2013 2 pi\u00e8ces \u2013"}, {"building": {"floor": null, "is_ground_floor": null}, "commute": {"computed_from": "address", "minutes_total": 49, "minutes_transit_only": 49, "mode": "transit", "notes": null}, "derived": {"arrondissement": "75010", "price_per_m2": 7962.33, "quartier": "Saint-Vincent-de-Paul"}, "description": null, "dvf_bonus": {"delta_vs_ref_pct": -12.8, "price_m2_ref": 9131.0, "ref_level": "arrondissement"}, "energy": {"dpe_letter": null}, "geo": {"confidence": 0.0, "lat": 48.881203, "lon": 2.365158, "precision": "address"}, "images": [], "listing_url": "https://www.seloger.com/annonces/achat/appartement/paris-10eme-75/louis-blanc-aqueduc/255916791.htm", "location_hint": {"address_text": "Louis Blanc-Aqueduc, Paris 10\u00e8me, 75010", "arrondissement_text": "Louis Blanc-Aqueduc", "confidence": 0.0, "poi_or_station": null, "quartier_text": null, "walk_minutes_to_poi": null}, "photos": ["https://mms.seloger.com/e/4/a/d/e4adeab5-f414-4111-b433-1a87af887d6e.jpg?ci_seal=012368b3985387410d31ce6344cb298686ca56fb\u0026w=1024\u0026h=576", "https://mms.seloger.com/9/1/3/3/9133c9e1-e727-406b-983e-26f0b96ce0c9.jpg?ci_seal=27d74165e298d1fe6353961739e16f96b339fc5d\u0026w=1024\u0026h=576", "https://mms.seloger.com/f/a/b/3/fab3f1c3-e6b5-46c1-903a-946afdfdfc1b.jpg?ci_seal=9cd1bfb473b86dd1249e7426dcea992a083bdb91\u0026w=1024\u0026h=576"], "price_eur": 465000, "property_condition": {"is_new": null, "is_old": null, "year_built": null}, "raw_text": null, "rooms": 3.0, "source": "seloger", "surface_m2": 58.4, "title": "Appartement au charme parisien"}, {"building": {"floor": null, "is_ground_floor": null}, "commute": {"computed_from": "address", "minutes_total": 34, "minutes_transit_only": 34, "mode": "transit", "notes": null}, "derived": {"arrondissement": "75015", "price_per_m2": 8776.6, "quartier": "Saint-Lambert"}, "description": null, "dvf_bonus": {"delta_vs_ref_pct": -6.44, "price_m2_ref": 9381.0, "ref_level": "arrondissement"}, "energy": {"dpe_letter": null}, "geo": {"confidence": 0.0, "lat": 48.8344576, "lon": 2.3005597, "precision": "address"}, "images": [], "listing_url": "https://www.seloger.com/annonces/achat/appartement/paris-15eme-75/cambronne-garibaldi/256340079.htm", "location_hint": {"address_text": "Saint Lambert, Paris 15\u00e8me, 75015", "arrondissement_text": "Saint Lambert", "confidence": 0.0, "poi_or_station": null, "quartier_text": null, "walk_minutes_to_poi": null}, "photos": ["https://mms.seloger.com/4/7/f/e/47fef097-bea4-471c-827b-7879dcd7e0e9.jpg?ci_seal=a2d892f1cc57089b4eec393071407010007e7349\u0026w=1024\u0026h=576", "https://mms.seloger.com/a/7/9/b/a79b1ad3-fde0-4216-ba98-ace862610436.jpg?ci_seal=2d4e82164e7bcf0c27adec37be125a1d8b41cf40\u0026w=1024\u0026h=576", "https://mms.seloger.com/8/d/4/d/8d4d36c1-cc77-4078-879b-be71d5b3d490.jpg?ci_seal=eb2aa8c517647d6835b0aba4516aa53310054947\u0026w=1024\u0026h=576"], "price_eur": 412500, "property_condition": {"is_new": null, "is_old": null, "year_built": null}, "raw_text": null, "rooms": 2.0, "source": "seloger", "surface_m2": 47.0, "title": "2 pi\u00e8ces"}, {"building": {"floor": null, "is_ground_floor": null}, "commute": {"computed_from": "address", "minutes_total": 25, "minutes_transit_only": 25, "mode": "transit", "notes": null}, "derived": {"arrondissement": "75015", "price_per_m2": 11815.79, "quartier": "Saint-Lambert"}, "description": null, "dvf_bonus": {"delta_vs_ref_pct": 25.95, "price_m2_ref": 9381.0, "ref_level": "arrondissement"}, "energy": {"dpe_letter": null}, "geo": {"confidence": 0.0, "lat": 48.8421616, "lon": 2.2927665, "precision": "address"}, "images": [], "listing_url": "https://www.seloger.com/annonces/achat/appartement/paris-15eme-75/250786815.htm", "location_hint": {"address_text": "Paris 15\u00e8me, 75015", "arrondissement_text": null, "confidence": 0.0, "poi_or_station": null, "quartier_text": null, "walk_minutes_to_poi": null}, "photos": ["https://mms.seloger.com/b/f/7/a/bf7acb6b-e5c6-41e8-bf38-b5e2bd612b50.jpg?ci_seal=fddfd0e42569a69d0c2840703fb97c268cd8fccb\u0026w=1024\u0026h=576", "https://mms.seloger.com/c/e/5/a/ce5a2223-f4b9-44ce-ac84-a0a05f926df7.jpg?ci_seal=ab463196413bfa0775ff1279dbff8fa3211c2d2c\u0026w=1024\u0026h=576", "https://mms.seloger.com/a/d/d/d/addd6f43-8029-4141-8ddb-ff2e046f699a.jpg?ci_seal=5b7ea3df3dbf39df228116b165f59851fdc68929\u0026w=1024\u0026h=576"], "price_eur": 449000, "property_condition": {"is_new": null, "is_old": null, "year_built": null}, "raw_text": null, "rooms": 2.0, "source": "seloger", "surface_m2": 38.0, "title": "Mairie du XV / M\u00b0 VAUGIRARD - 2 pi\u00e8ces 38m\u00b2"}, {"building": {"floor": null, "is_ground_floor": null}, "commute": {"computed_from": "address", "minutes_total": 25, "minutes_transit_only": 25, "mode": "transit", "notes": null}, "derived": {"arrondissement": "75015", "price_per_m2": 10937.5, "quartier": "Saint-Lambert"}, "description": null, "dvf_bonus": {"delta_vs_ref_pct": 16.59, "price_m2_ref": 9381.0, "ref_level": "arrondissement"}, "energy": {"dpe_letter": null}, "geo": {"confidence": 0.0, "lat": 48.8421616, "lon": 2.2927665, "precision": "address"}, "images": [], "listing_url": "https://www.seloger.com/annonces/achat/appartement/paris-15eme-75/cambronne-garibaldi/250812885.htm", "location_hint": {"address_text": "Cambronne-Garibaldi, Paris 15\u00e8me, 75015", "arrondissement_text": "Cambronne-Garibaldi", "confidence": 0.0, "poi_or_station": null, "quartier_text": null, "walk_minutes_to_poi": null}, "photos": ["https://mms.seloger.com/5/a/b/f/5abff78d-2ca7-4c69-9e9b-2c0070f5de15.jpg?ci_seal=5c073d6a2b1042a1b8f9d81ef20ab001752373aa\u0026w=1024\u0026h=576", "https://mms.seloger.com/4/a/0/7/4a072f06-4dce-4eab-b884-882fa6a34578.jpg?ci_seal=c8fac01b11cb7fc60a62dad75ec8fc06207be50a\u0026w=1024\u0026h=576", "https://mms.seloger.com/5/6/4/9/5649964c-27ab-4d57-8b6e-c38efed62458.jpg?ci_seal=ce52331dede12b80455f2f552b065f7d4f4f134c\u0026w=1024\u0026h=576"], "price_eur": 350000, "property_condition": {"is_new": null, "is_old": null, "year_built": null}, "raw_text": null, "rooms": 2.0, "source": "seloger", "surface_m2": 32.0, "title": "Studio/2 pi\u00e8ces - M\u00e9tro Cambronne"}, {"building": {"floor": null, "is_ground_floor": null}, "commute": {"computed_from": "address", "minutes_total": 49, "minutes_transit_only": 49, "mode": "transit", "notes": null}, "derived": {"arrondissement": "75010", "price_per_m2": 7388.06, "quartier": "Saint-Vincent-de-Paul"}, "description": null, "dvf_bonus": {"delta_vs_ref_pct": -19.09, "price_m2_ref": 9131.0, "ref_level": "arrondissement"}, "energy": {"dpe_letter": null}, "geo": {"confidence": 0.0, "lat": 48.881203, "lon": 2.365158, "precision": "address"}, "images": [], "listing_url": "https://www.seloger.com/annonces/achat/appartement/paris-10eme-75/louis-blanc-aqueduc/243327215.htm", "location_hint": {"address_text": "Louis Blanc-Aqueduc, Paris 10\u00e8me, 75010", "arrondissement_text": "Louis Blanc-Aqueduc", "confidence": 0.0, "poi_or_station": null, "quartier_text": null, "walk_minutes_to_poi": null}, "photos": ["https://mms.seloger.com/1/f/9/9/1f990db8-6603-48f7-bb15-5c84d12df6b3.jpg?ci_seal=926823fde8333902c7d86f0e505e39867c5fed3f\u0026w=1024\u0026h=576", "https://mms.seloger.com/0/c/f/7/0cf764e1-0713-4391-9b38-cb3d59ac510a.jpg?ci_seal=fafecd9270bc4a0061e62cf64aca193c01adefcb\u0026w=1024\u0026h=576", "https://mms.seloger.com/8/9/2/f/892ffabe-5fbe-419e-a3b6-a00e674e319f.jpg?ci_seal=a25fb01fb4f6dd9facf03c8bf97bc0684d139f5f\u0026w=1024\u0026h=576"], "price_eur": 495000, "property_condition": {"is_new": null, "is_old": null, "year_built": null}, "raw_text": null, "rooms": 3.0, "source": "seloger", "surface_m2": 67.0, "title": "Tr\u00e8s bel appartement T3 spacieux + parking"}, {"building": {"floor": null, "is_ground_floor": null}, "commute": {"computed_from": "address", "minutes_total": 20, "minutes_transit_only": 20, "mode": "transit", "notes": null}, "derived": {"arrondissement": "75015", "price_per_m2": 9000.0, "quartier": "Saint-Lambert"}, "description": null, "dvf_bonus": {"delta_vs_ref_pct": -4.06, "price_m2_ref": 9381.0, "ref_level": "arrondissement"}, "energy": {"dpe_letter": null}, "geo": {"confidence": 0.0, "lat": 48.8498836, "lon": 2.2865039, "precision": "address"}, "images": [], "listing_url": "https://www.seloger.com/annonces/achat/appartement/paris-15eme-75/emeriau-zola/250933487.htm", "location_hint": {"address_text": "Emeriau-Zola, Paris 15\u00e8me, 75015", "arrondissement_text": "Emeriau-Zola", "confidence": 0.0, "poi_or_station": null, "quartier_text": null, "walk_minutes_to_poi": null}, "photos": ["https://mms.seloger.com/2/d/e/0/2de0c3f1-7369-4cc2-924d-f4ae80490a76.jpg?ci_seal=3db7dac95f5a9bc850dc5b5bf4943f34e8ddeca2\u0026w=1024\u0026h=576", "https://mms.seloger.com/1/8/b/9/18b9e201-9505-466e-86ac-8463b3d2e4d4.jpg?ci_seal=9ebf7376048d7a4d19d4ae86f2df363a66706af3\u0026w=1024\u0026h=576", "https://mms.seloger.com/2/5/7/5/25752092-cff4-48f7-a943-306e6423a71e.jpg?ci_seal=902972082d0a233fc3aad9d4b06397283d5218dd\u0026w=1024\u0026h=576"], "price_eur": 495000, "property_condition": {"is_new": null, "is_old": null, "year_built": null}, "raw_text": null, "rooms": 2.0, "source": "seloger", "surface_m2": 55.0, "title": "Appartement 2 pi\u00e8ces"}, {"building": {"floor": null, "is_ground_floor": null}, "commute": {"computed_from": "address", "minutes_total": 51, "minutes_transit_only": 51, "mode": "transit", "notes": null}, "derived": {"arrondissement": "75011", "price_per_m2": 10405.41, "quartier": "Folie-Mericourt"}, "description": null, "dvf_bonus": {"delta_vs_ref_pct": 5.75, "price_m2_ref": 9840.0, "ref_level": "arrondissement"}, "energy": {"dpe_letter": null}, "geo": {"confidence": 0.0, "lat": 48.8596266, "lon": 2.3867017, "precision": "address"}, "images": [], "listing_url": "https://www.seloger.com/annonces/achat/appartement/paris-11eme-75/leon-blum-folie-regnault/256524517.htm", "location_hint": {"address_text": "L\u00e9on-Blum Folie-Regnault, Paris 11\u00e8me, 75011", "arrondissement_text": "L\u00e9on-Blum Folie-Regnault", "confidence": 0.0, "poi_or_station": null, "quartier_text": null, "walk_minutes_to_poi": null}, "photos": ["https://mms.seloger.com/d/5/9/9/d5993c23-d7dd-407d-9126-34a90673b7ae.jpg?ci_seal=dc105ca5db9bb924f03a308b5742fe1527d81858\u0026w=1024\u0026h=576", "https://mms.seloger.com/4/6/4/7/4647e233-1983-46c8-8af0-66b5056e1ae1.jpg?ci_seal=688c7da20abd6d64120d336b40b6b688c1640e11\u0026w=1024\u0026h=576", "https://mms.seloger.com/c/2/4/5/c2455113-c4c3-423b-908c-862175f408d6.jpg?ci_seal=075f13e9540d543b9a685b6b72ccf877802e8d24\u0026w=1024\u0026h=576", "https://mms.seloger.com/6/1/1/1/611186f4-38d4-447d-91e4-f8390855b06d.jpg?ci_seal=243e29a3ecfa0e61c25a9270cf202a542286b1b7\u0026w=768\u0026h=560"], "price_eur": 385000, "property_condition": {"is_new": null, "is_old": null, "year_built": null}, "raw_text": null, "rooms": 2.0, "source": "seloger", "surface_m2": 37.0, "title": "Appartement 2 pi\u00e8ces 37m\u00b2 4eme \u00e9tage sans asc"}, {"building": {"floor": null, "is_ground_floor": null}, "commute": {"computed_from": "address", "minutes_total": 39, "minutes_transit_only": 39, "mode": "transit", "notes": null}, "derived": {"arrondissement": "75015", "price_per_m2": 9265.31, "quartier": "Saint-Lambert"}, "description": null, "dvf_bonus": {"delta_vs_ref_pct": -1.23, "price_m2_ref": 9381.0, "ref_level": "arrondissement"}, "energy": {"dpe_letter": null}, "geo": {"confidence": 0.0, "lat": 48.82820539999999, "lon": 2.2986505, "precision": "address"}, "images": [], "listing_url": "https://www.seloger.com/annonces/achat/appartement/paris-15eme-75/georges-brassens/256596813.htm", "location_hint": {"address_text": "Georges Brassens, Paris 15\u00e8me, 75015", "arrondissement_text": "Georges Brassens", "confidence": 0.0, "poi_or_station": null, "quartier_text": null, "walk_minutes_to_poi": null}, "photos": ["https://mms.seloger.com/e/3/6/a/e36a87cc-6dff-43d4-acee-bfe9edd27947.jpg?ci_seal=47b4e7f636eae0692a2544e4a2f993fb0476f718\u0026w=1024\u0026h=576", "https://mms.seloger.com/d/f/a/1/dfa15fb9-75b1-4b5d-9414-113eba69ca52.jpg?ci_seal=4e2924bcf319bae57b58a15f6e7c05feb17615a4\u0026w=1024\u0026h=576", "https://mms.seloger.com/c/d/5/1/cd5195e6-5ad5-40e7-8e85-0a33f5ace4f5.jpg?ci_seal=9867d754a99b6881eb95f8c15f3b59ee94388574\u0026w=1024\u0026h=576"], "price_eur": 454000, "property_condition": {"is_new": null, "is_old": null, "year_built": null}, "raw_text": null, "rooms": 3.0, "source": "seloger", "surface_m2": 49.0, "title": "PARIS XV - 45 MORILLONS -3P-48M2"}];
    
    // Config
    const weights = { prix: 4, surface: 6, pieces: 1, trajet: 3, deltaMarche: 5, arrondissement: 9 };
    const districtScores = {
      "75001": 10, "75002": 10, "75003": 10, "75004": 8, "75005": 5,
      "75006": 5, "75007": 5, "75008": 6, "75009": 6, "75010": 4,
      "75011": 8, "75012": 2, "75013": 2, "75014": 2, "75015": 6,
      "75016": 7, "75017": 5, "75018": 1, "75019": 1, "75020": 0
    };
    
    let deltaMode = 'price';
    let currentSort = 'score';
    let mobileView = 'list'; // 'list' or 'map'
    let map = null;
    let mapInitialized = false;
    let markers = {};
    let markerCluster = null;

    // Score Calculation
    function calculateScores() {
      const minMax = arr => {
        const vals = arr.filter(v => v != null && !isNaN(v));
        if (!vals.length) return { min: 0, max: 1, span: 1 };
        const min = Math.min(...vals), max = Math.max(...vals);
        return { min, max, span: max - min || 1 };
      };

      const mm = {
        price: minMax(items.map(i => i.derived?.price_per_m2)),
        commute: minMax(items.map(i => i.commute?.minutes_total)),
        surface: minMax(items.map(i => i.surface_m2)),
        rooms: minMax(items.map(i => i.rooms)),
        delta: minMax(items.map(i => i.dvf_bonus?.delta_vs_ref_pct))
      };

      const sumW = Object.values(weights).reduce((a, b) => a + b, 0);

      items.forEach(item => {
        const v = {
          price: item.derived?.price_per_m2 || 0,
          commute: item.commute?.minutes_total || 60,
          surface: item.surface_m2 || 0,
          rooms: item.rooms || 0,
          delta: item.dvf_bonus?.delta_vs_ref_pct || 0
        };

        let arr = item.derived?.arrondissement || '';
        if (!arr && item.location_hint?.address_text) {
          const m = item.location_hint.address_text.match(/(75\d{3})/);
          if (m) arr = m[1];
        }
        item._arr = arr;
        const distScore = (districtScores[arr] ?? 0) / 10;

        const norm = key => (v[key] - mm[key].min) / mm[key].span;
        const nPrice = 1 - norm('price');
        const nCommute = 1 - norm('commute');
        const nSurface = norm('surface');
        const nRooms = norm('rooms');
        const nDelta = 1 - norm('delta');

        item._score = Math.max(0, Math.min(10, (
          weights.prix * nPrice +
          weights.surface * nSurface +
          weights.pieces * nRooms +
          weights.trajet * nCommute +
          weights.deltaMarche * nDelta +
          weights.arrondissement * distScore
        ) / sumW * 10));
      });
    }

    // Get filtered & sorted items
    function getFilteredItems() {
      const surfaceMin = parseInt(document.getElementById('filterSurface').value) || 0;
      const arrFilter = document.getElementById('filterArr').value;

      return items
        .filter(i => (i.surface_m2 || 0) >= surfaceMin)
        .filter(i => !arrFilter || i._arr === arrFilter)
        .sort((a, b) => {
          switch(currentSort) {
            case 'score': return b._score - a._score;
            case 'price_asc': return (a.price_eur||0) - (b.price_eur||0);
            case 'price_desc': return (b.price_eur||0) - (a.price_eur||0);
            case 'surface_desc': return (b.surface_m2||0) - (a.surface_m2||0);
            case 'commute_asc': return (a.commute?.minutes_total||999) - (b.commute?.minutes_total||999);
            case 'delta_asc': return (a.dvf_bonus?.delta_vs_ref_pct||0) - (b.dvf_bonus?.delta_vs_ref_pct||0);
            default: return 0;
          }
        });
    }

    // Score color
    function scoreColor(s) {
      if (s >= 7) return { bg: 'bg-emerald-500', text: 'text-white' };
      if (s >= 5) return { bg: 'bg-amber-400', text: 'text-slate-900' };
      if (s >= 3) return { bg: 'bg-orange-500', text: 'text-white' };
      return { bg: 'bg-red-500', text: 'text-white' };
    }

    // Delta display
    function deltaHtml(item) {
      const d = item.dvf_bonus?.delta_vs_ref_pct;
      if (d == null) return '<span class="text-slate-400">-</span>';
      
      const pct = (d > 0 ? '+' : '') + d.toFixed(1) + '%';
      const color = d < -5 ? 'text-emerald-600 dark:text-emerald-400' : 
                    d > 5 ? 'text-red-600 dark:text-red-400' : 'text-slate-500';
      
      if (deltaMode === 'delta') {
        return `<span class="${color} font-semibold">${pct}</span>`;
      }
      const ppm = item.derived?.price_per_m2 ? Math.round(item.derived.price_per_m2).toLocaleString('fr-FR') : '?';
      return `<span class="font-semibold">${ppm} ‚Ç¨/m¬≤</span> <span class="${color} text-xs">(${pct})</span>`;
    }

    // Render Cards with carousel
    function renderCards() {
      const container = document.getElementById('cardsGrid');
      const filtered = getFilteredItems();
      
      document.getElementById('countBadge').textContent = filtered.length + ' biens';
      document.getElementById('emptyState').classList.toggle('hidden', filtered.length > 0);
      
      container.innerHTML = filtered.map((item, idx) => {
        const sc = scoreColor(item._score);
        const photos = item.photos || [];
        const hasMultiple = photos.length > 1;
        
        const carouselHtml = photos.length > 0 
          ? `<div class="carousel relative w-full sm:w-36 shrink-0" data-idx="${idx}">
               <img src="${photos[0]}" alt="" class="carousel-img card-img w-full h-full object-cover rounded-t-xl sm:rounded-l-xl sm:rounded-tr-none" data-photos='${JSON.stringify(photos)}' data-current="0">
               ${hasMultiple ? `
                 <button class="carousel-prev absolute left-1 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs">&lt;</button>
                 <button class="carousel-next absolute right-1 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs">&gt;</button>
                 <div class="absolute bottom-1 left-1/2 -translate-x-1/2 bg-black/50 text-white text-xs px-2 py-0.5 rounded-full carousel-counter">1/${photos.length}</div>
               ` : ''}
             </div>`
          : `<div class="w-full sm:w-36 shrink-0 bg-slate-200 dark:bg-slate-700 flex items-center justify-center rounded-t-xl sm:rounded-l-xl sm:rounded-tr-none" style="aspect-ratio:4/3">
               <span class="text-slate-400 text-xs">Pas de photo</span>
             </div>`;
        
        return `
          <article class="bg-white dark:bg-slate-800 rounded-xl shadow-sm hover:shadow-md transition-shadow border border-slate-200 dark:border-slate-700 flex flex-col sm:flex-row overflow-hidden group" data-url="${item.listing_url}">
            ${carouselHtml}
            <div class="flex-1 p-3 sm:p-4 flex flex-col min-w-0">
              <div class="flex items-start justify-between gap-2 mb-1">
                <h3 class="font-semibold text-sm sm:text-base truncate flex-1" title="${item.title || ''}">${item.title || 'Sans titre'}</h3>
                <div class="${sc.bg} ${sc.text} score-badge shrink-0">${item._score.toFixed(1)}</div>
              </div>
              
              <p class="text-xs text-slate-500 dark:text-slate-400 truncate mb-2">${item._arr || 'Paris'}</p>
              
              <div class="flex flex-wrap gap-1.5 mb-3">
                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300">${item.surface_m2 || '?'} m¬≤</span>
                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300">${item.rooms || '?'} pi√®ces</span>
                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300">${item.commute?.minutes_total || '?'} min</span>
              </div>
              
              <div class="mt-auto flex items-end justify-between">
                <div>
                  <div class="text-lg font-bold">${(item.price_eur || 0).toLocaleString('fr-FR')} ‚Ç¨</div>
                  <div class="text-xs">${deltaHtml(item)}</div>
                </div>
                <a href="${item.listing_url}" target="_blank" rel="noopener" class="text-sm text-blue-600 dark:text-blue-400 hover:underline font-medium">
                  Voir ‚Üí
                </a>
              </div>
            </div>
          </article>
        `;
      }).join('');
      
      // Carousel controls
      container.querySelectorAll('.carousel-prev').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const carousel = btn.closest('.carousel');
          const img = carousel.querySelector('.carousel-img');
          const photos = JSON.parse(img.dataset.photos);
          let current = parseInt(img.dataset.current);
          current = (current - 1 + photos.length) % photos.length;
          img.src = photos[current];
          img.dataset.current = current;
          carousel.querySelector('.carousel-counter').textContent = `${current + 1}/${photos.length}`;
        });
      });
      
      container.querySelectorAll('.carousel-next').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const carousel = btn.closest('.carousel');
          const img = carousel.querySelector('.carousel-img');
          const photos = JSON.parse(img.dataset.photos);
          let current = parseInt(img.dataset.current);
          current = (current + 1) % photos.length;
          img.src = photos[current];
          img.dataset.current = current;
          carousel.querySelector('.carousel-counter').textContent = `${current + 1}/${photos.length}`;
        });
      });

      // Hover events for map
      container.querySelectorAll('article').forEach(card => {
        card.addEventListener('mouseenter', () => highlightMarker(card.dataset.url, true));
        card.addEventListener('mouseleave', () => highlightMarker(card.dataset.url, false));
      });
    }

    // Map
    function initMap(force = false) {
      if (mapInitialized) return;
      
      const el = document.getElementById('map');
      const panel = document.getElementById('mapPanel');
      if (!el || !panel) return;
      
      // On mobile, only init when panel is visible
      const isVisible = !panel.classList.contains('hidden') || window.innerWidth >= 1024;
      if (!isVisible && !force) return;
      
      mapInitialized = true;
      map = L.map('map', { zoomControl: false }).setView([48.86, 2.35], 12);
      L.control.zoom({ position: 'topright' }).addTo(map);
      
      L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
        attribution: '¬© OpenStreetMap ¬© CARTO',
        maxZoom: 19
      }).addTo(map);

      updateMapMarkers();
    }

    function updateMapMarkers() {
      if (!map) return;
      
      // Clear existing cluster and markers
      if (markerCluster) {
        map.removeLayer(markerCluster);
      }
      markers = {};
      
      // Create new cluster group with custom styling
      markerCluster = L.markerClusterGroup({
        maxClusterRadius: 50,
        spiderfyOnMaxZoom: true,
        showCoverageOnHover: false,
        zoomToBoundsOnClick: true,
        iconCreateFunction: function(cluster) {
          const count = cluster.getChildCount();
          let size = 'small';
          let className = 'bg-blue-500';
          if (count >= 10) { size = 'large'; className = 'bg-blue-700'; }
          else if (count >= 5) { size = 'medium'; className = 'bg-blue-600'; }
          
          return L.divIcon({
            html: `<div class="flex items-center justify-center w-full h-full rounded-full ${className} text-white font-bold shadow-lg border-2 border-white">${count}</div>`,
            className: 'custom-cluster',
            iconSize: L.point(40, 40)
          });
        }
      });

      const filtered = getFilteredItems();
      const bounds = L.latLngBounds();

      filtered.forEach(item => {
        if (!item.geo?.lat || !item.geo?.lon) return;
        
        const lat = item.geo.lat;
        const lon = item.geo.lon;
        
        const color = item._score >= 7 ? '#10b981' : item._score >= 5 ? '#f59e0b' : item._score >= 3 ? '#f97316' : '#ef4444';
        
        const marker = L.circleMarker([lat, lon], {
          radius: 10,
          fillColor: color,
          color: '#fff',
          weight: 2,
          opacity: 1,
          fillOpacity: 0.9
        });

        const photo = item.photos?.[0];
        const photoHtml = photo 
          ? `<img src="${photo}" alt="" style="width:100%;height:80px;object-fit:cover;border-radius:4px;margin-bottom:8px">`
          : '';
        
        marker.bindPopup(`
          <div class="text-sm" style="min-width:200px;max-width:240px">
            ${photoHtml}
            <strong style="display:block;margin-bottom:4px">${item.title || 'Bien'}</strong>
            <span style="color:#64748b">${(item.price_eur||0).toLocaleString()} ‚Ç¨ ‚Ä¢ ${item.surface_m2||'?'} m¬≤</span><br>
            <strong>Score: ${item._score.toFixed(1)}/10</strong><br>
            <a href="${item.listing_url}" target="_blank" rel="noopener" style="color:#2563eb;text-decoration:none;font-weight:500">Voir l'annonce ‚Üí</a>
          </div>
        `, { maxWidth: 260 });

        markerCluster.addLayer(marker);
        markers[item.listing_url] = marker;
        bounds.extend([lat, lon]);
      });

      map.addLayer(markerCluster);

      if (bounds.isValid()) {
        map.fitBounds(bounds, { padding: [40, 40], maxZoom: 15 });
      }
    }

    function highlightMarker(url, active) {
      const m = markers[url];
      if (!m) return;
      if (active) {
        m.setStyle({ radius: 14, weight: 3, color: '#3b82f6' });
        m.openPopup();
      } else {
        m.setStyle({ radius: 10, weight: 2, color: '#fff' });
        m.closePopup();
      }
    }

    // Populate arrondissement filter
    function populateArrFilter() {
      const arrs = [...new Set(items.map(i => i._arr).filter(Boolean))].sort();
      const select = document.getElementById('filterArr');
      arrs.forEach(arr => {
        const opt = document.createElement('option');
        opt.value = arr;
        opt.textContent = arr;
        select.appendChild(opt);
      });
    }

    // Init
    document.addEventListener('DOMContentLoaded', () => {
      // Dark mode
      if (localStorage.theme === 'dark' || (!localStorage.theme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
      }

      calculateScores();
      populateArrFilter();
      renderCards();
      initMap();

      // Event handlers
      document.getElementById('toggleDark').addEventListener('click', () => {
        document.documentElement.classList.toggle('dark');
        localStorage.theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
      });

      document.getElementById('toggleFilters').addEventListener('click', () => {
        document.getElementById('filtersPanel').classList.toggle('hidden');
      });

      document.getElementById('toggleView').addEventListener('click', () => {
        mobileView = mobileView === 'list' ? 'map' : 'list';
        const listPanel = document.getElementById('listPanel');
        const mapPanel = document.getElementById('mapPanel');
        
        if (mobileView === 'map') {
          listPanel.classList.add('hidden');
          mapPanel.classList.remove('hidden');
          mapPanel.classList.add('flex');
        } else {
          listPanel.classList.remove('hidden');
          mapPanel.classList.add('hidden');
          mapPanel.classList.remove('flex');
        }
        
        document.getElementById('iconMap').classList.toggle('hidden', mobileView === 'map');
        document.getElementById('iconList').classList.toggle('hidden', mobileView === 'list');
        
        if (mobileView === 'map') {
          setTimeout(() => {
            // Lazy init map on first mobile reveal
            if (!mapInitialized) {
              initMap(true);
            } else if (map) {
              map.invalidateSize();
              // Fit bounds to markers
              const bounds = L.latLngBounds();
              Object.values(markers).forEach(m => bounds.extend(m.getLatLng()));
              if (bounds.isValid()) map.fitBounds(bounds, { padding: [40, 40], maxZoom: 15 });
            }
          }, 150);
        }
      });

      document.getElementById('sortSelect').addEventListener('change', e => {
        currentSort = e.target.value;
        renderCards();
        updateMapMarkers();
      });

      document.getElementById('btnModePrice').addEventListener('click', () => {
        deltaMode = 'price';
        document.getElementById('btnModePrice').className = 'px-3 py-1.5 text-sm bg-slate-800 text-white dark:bg-slate-200 dark:text-slate-900';
        document.getElementById('btnModeDelta').className = 'px-3 py-1.5 text-sm bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700';
        renderCards();
      });

      document.getElementById('btnModeDelta').addEventListener('click', () => {
        deltaMode = 'delta';
        document.getElementById('btnModeDelta').className = 'px-3 py-1.5 text-sm bg-slate-800 text-white dark:bg-slate-200 dark:text-slate-900';
        document.getElementById('btnModePrice').className = 'px-3 py-1.5 text-sm bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700';
        renderCards();
      });

      document.getElementById('filterSurface').addEventListener('change', () => {
        renderCards();
        updateMapMarkers();
      });

      document.getElementById('filterArr').addEventListener('change', () => {
        renderCards();
        updateMapMarkers();
      });
    });
  </script>
</body>
</html>